!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n((e="undefined"!=typeof globalThis?globalThis:e||self).parser={})}(this,(function(e){"use strict";e.pgn2json=function(e){const n=e.split("\n");var i,t={str:{},moves:[],annotations:[],nag:[]};n.forEach(((e,n,i)=>i[n]=i[n].trim().replace("\r","")));for(let e=0;e<n.length;e++){var s=n[e];if("["===s[0]){let e=s.substring(1,s.indexOf(" ")),n=s.substring(s.indexOf(" ")+2,s.length-2);t.str[e]=n}else if("["!==s[0]&&""!==s.trim()){i=n.slice(n.indexOf(s)).join(" ").trim().split("");break}}var r=[],o=i.join("").split(" ");for(let e=1;o.includes(`${e}.`);e++)r.push(o.indexOf(`${e}.`));for(;-1!==i.indexOf("{");){var f=i.indexOf("{"),l=i.indexOf("}"),u=i.splice(f,l-f+2).join(""),d=o.indexOf(u.split(" ")[0]);t.annotations.push({moveCount:r.filter((e=>e<d)).length,comment:u.substring(1,u.length-2)})}(i=i.join("").split(" ")).pop(),r=[];for(let e=1;i.includes(`${e}.`);e++)r.push(i.indexOf(`${e}.`));var p=[];return t.nag=i.filter((e=>e.includes("$"))).map((e=>{var n=0;p.length&&(n=p.reverse()[0]);var t=r.filter((t=>t<i.indexOf(e,n)));return p.push(t.reverse()[0]),{moveCount:t.length,value:e}})),i=i.filter((e=>!e.includes(".")&&!e.includes("$"))),t.moves=i,JSON.stringify(t)},Object.defineProperty(e,"__esModule",{value:!0})}));